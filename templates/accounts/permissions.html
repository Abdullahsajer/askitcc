{% extends "base.html" %}
{% block title %}إدارة الصلاحيات{% endblock %}

{% block content %}

<h2 class="text-2xl font-bold mb-6 text-sky-700">إدارة صلاحيات النظام</h2>

<div class="bg-white p-6 rounded-xl shadow border">

  <!-- اختيار الدور -->
  <form method="get" class="mb-6">
      <label class="block mb-2 text-gray-700 font-semibold">اختر الدور:</label>
      <select name="role" onchange="this.form.submit()"
              class="p-3 border rounded w-full max-w-sm bg-white">
          <option value="">— اختر —</option>
          {% for role in roles %}
              <option value="{{ role.id }}"
                {% if selected_role and role.id == selected_role.id %}selected{% endif %}>
                  {{ role.name }}
              </option>
          {% endfor %}
      </select>
  </form>

  {% if selected_role %}

  <form method="post">
      {% csrf_token %}
      <input type="hidden" name="role_id" value="{{ selected_role.id }}">

      <h3 class="text-xl font-semibold mb-4 text-emerald-700">
          الصلاحيات المتاحة للدور: <span class="text-black">{{ selected_role.name }}</span>
      </h3>

      <!-- مجموعات الصلاحيات -->
      <div class="space-y-6">

          {% for group in groups %}
          <div class="p-4 border rounded-lg">
              <h4 class="font-bold text-sky-600 mb-2">{{ group.name }}</h4>

              <div class="grid grid-cols-1 md:grid-cols-2 gap-3">

                  {% for perm in group.permission_set.all %}
                  <label class="flex items-center gap-2">
                      <input type="checkbox" name="permissions" value="{{ perm.id }}"
                          {% if perm.id in role_permissions %}checked{% endif %}
                          class="w-4 h-4">
                      <span>{{ perm.name }}</span>
                  </label>
                  {% endfor %}

              </div>
          </div>
          {% endfor %}

      </div>

      <button class="mt-6 bg-sky-600 hover:bg-sky-700 text-white px-6 py-3 rounded-lg">
          حفظ الصلاحيات
      </button>

  </form>

  {% endif %}

</div>

{% endblock %}
