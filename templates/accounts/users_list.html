{% extends "base.html" %}
{% block title %}إدارة المستخدمين{% endblock %}

{% block content %}

<h2 class="text-2xl font-bold mb-6 text-sky-700 flex justify-between items-center">

    <span>إدارة المستخدمين</span>

    <a href="{% url 'accounts_app:add_user' %}" 
    class="bg-sky-600 text-white px-4 py-2 rounded-lg hover:bg-sky-700">
    ➕ إضافة مستخدم جديد
    </a>

</h2>

<div class="bg-white shadow rounded-xl overflow-hidden">

    <table class="w-full text-right">
        <thead class="bg-gray-100 text-gray-700 text-sm">
            <tr>
                <th class="p-3">اسم المستخدم</th>
                <th class="p-3">البريد الإلكتروني</th>
                <th class="p-3">الصلاحية</th>
                <th class="p-3">الحالة</th>
                <th class="p-3">إجراءات</th>
            </tr>
        </thead>

        <tbody class="text-sm text-gray-700">

            {% for u in users %}
            <tr class="border-b hover:bg-gray-50">

                <!-- الاسم -->
                <td class="p-3 font-medium">{{ u.username }}</td>

                <!-- البريد -->
                <td class="p-3">{{ u.email|default:"-" }}</td>

                <!-- الصلاحية -->
                <td class="p-3">
                    {% if u.profile %}
                        {{ u.profile.get_role_display }}
                    {% else %}
                        <span class="text-gray-400">(لا يوجد بروفايل)</span>
                    {% endif %}
                </td>

                <!-- حالة المستخدم -->
                <td class="p-3">
                    {% if u.is_active %}
                        <span class="text-emerald-600 font-bold">نشط</span>
                    {% else %}
                        <span class="text-red-600 font-bold">معطل</span>
                    {% endif %}
                </td>

                <!-- الإجراءات -->
                <td class="p-3 flex gap-3">

                    <!-- تعديل -->
                    <a href="{% url 'accounts_app:edit_user' u.id %}"
                        class="text-sky-700 font-medium hover:underline">
                        تعديل
                    </a>

                    <!-- إعادة تعيين كلمة المرور -->
                    <a href="{% url 'accounts_app:reset_password' u.id %}"
                        class="text-purple-600 font-medium hover:underline">
                        كلمة المرور
                    </a>

                    <!-- تفعيل / تعطيل -->
                    {% if u.is_active %}
                        <a href="{% url 'accounts_app:deactivate_user' u.id %}"
                            class="text-red-600 font-medium hover:underline"
                            onclick="return confirm('هل تريد تعطيل المستخدم؟');">
                            تعطيل
                        </a>
                    {% else %}
                        <a href="{% url 'accounts_app:activate_user' u.id %}"
                            class="text-emerald-600 font-medium hover:underline"
                            onclick="return confirm('هل تريد تفعيل المستخدم؟');">
                            تفعيل
                        </a>
                    {% endif %}

                    <!-- حذف -->
                    <a href="{% url 'accounts_app:delete_user' u.id %}"
                        class="text-gray-600 font-medium hover:underline"
                        onclick="return confirm('هل أنت متأكد من حذف المستخدم نهائيًا؟');">
                        حذف
                    </a>

                </td>
            </tr>

            {% empty %}
            <tr>
                <td colspan="5" class="p-4 text-center text-gray-500">
                    لا يوجد مستخدمون مسجلون.
                </td>
            </tr>
            {% endfor %}

        </tbody>
    </table>

</div>

{% endblock %}
